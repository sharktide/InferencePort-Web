<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opening InferencePort AI…</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #57709c, #4b5563, #777878);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      color: #e5e7eb;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .card {
      backdrop-filter: blur(10px);
      background: rgba(15, 23, 42, 0.85);
      border: none;
      border-radius: 1rem;
      box-shadow: 0 25px 50px rgba(0,0,0,.35);
    }

    .spinner-border {
      width: 3rem;
      height: 3rem;
    }

    .status-muted {
      color: #9ca3af;
    }

    .hidden {
      display: none !important;
    }

    .btn-primary {
      background-color: #f59e0b;
      border-color: #f59e0b;
      color: #111827;
      font-weight: 600;
    }

    .btn-primary:hover {
      background-color: #fbbf24;
      border-color: #fbbf24;
    }

    .error {
      color: #f87171;
    }
  </style>
</head>

<body class="d-flex align-items-center justify-content-center px-3">

  <div class="card p-4 p-md-5 text-center" style="max-width: 520px; width: 100%;">
    <h1 class="fw-bold mb-3">Opening InferencePort AI</h1>

    <p id="status-text" class="status-muted mb-4">
      Redirecting you to the authorized desktop application…
    </p>

    <div id="spinner" class="mb-4">
      <div class="spinner-border text-warning" role="status"></div>
    </div>

    <div id="manual-section" class="hidden">
      <p class="mb-3">
        Your browser may have blocked the automatic launch.
      </p>

      <button id="open-btn" class="btn btn-primary btn-lg w-100 mb-2">
        Open InferencePort AI
      </button>

      <small class="status-muted">
        If prompted, allow your browser to open the application.
      </small>
    </div>

    <div id="error-section" class="hidden mt-4">
      <p class="error fw-semibold">
        We couldn’t open the application.
      </p>
      <p class="status-muted">
        Make sure InferencePort AI is installed, then try again.
      </p>
    </div>
  </div>

  <script>
    (function () {
      const hash = window.location.hash.slice(1);
      if (!hash) return;

      const deepLink = `inferenceport-ai:///auth/callback#${hash}`;

      const spinner = document.getElementById("spinner");
      const manual = document.getElementById("manual-section");
      const error = document.getElementById("error-section");
      const button = document.getElementById("open-btn");

      let opened = false;

      function attemptOpen() {
        try {
          window.location.href = deepLink;
          opened = true;
        } catch {
          opened = false;
        }
      }

      attemptOpen();

      setTimeout(() => {
        if (!opened) {
          spinner.classList.add("hidden");
          manual.classList.remove("hidden");
        }
      }, 1200);

      button?.addEventListener("click", () => {
        try {
          window.location.href = deepLink;

          setTimeout(() => {
            error.classList.remove("hidden");
          }, 1200);
        } catch {
          error.classList.remove("hidden");
        }
      });
    })();
  </script>

</body>
</html>
